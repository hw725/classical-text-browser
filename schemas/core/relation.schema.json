{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "relation.schema.json",
  "title": "Relation — 엔티티 간 관계",
  "description": "Agent, Concept, TextBlock 사이의 관계를 표현한다. predicate는 구조적 동사만 허용하고, 해석적 뉘앙스는 코어 밖에 저장한다 (operation-rules 5). core-schema-v1.3.md 섹션 6 기반.",
  "type": "object",
  "required": ["id", "subject_id", "subject_type", "predicate", "status"],
  "additionalProperties": false,
  "properties": {
    "id": {
      "type": "string",
      "description": "UUID.",
      "format": "uuid"
    },
    "subject_id": {
      "type": "string",
      "description": "주어(subject) 엔티티의 id.",
      "format": "uuid"
    },
    "subject_type": {
      "type": "string",
      "description": "주어 엔티티의 유형.",
      "enum": ["agent", "concept"]
    },
    "predicate": {
      "type": "string",
      "description": "관계 술어. snake_case, 공백 불가, 최대 64자. 구조적 행위만 — 해석적 뉘앙스는 코어 밖에서. (operation-rules 5, core-schema 6.1) 허용 예: governs, utters, sacrifices_life. 불허 예: ought_to_sacrifice_life_when_facing_moral_danger",
      "pattern": "^[a-z][a-z0-9_]{0,63}$"
    },
    "object_id": {
      "type": ["string", "null"],
      "description": "목적어(object) 엔티티의 id. object_value와 상호 배타적이지 않다.",
      "format": "uuid",
      "default": null
    },
    "object_type": {
      "type": ["string", "null"],
      "description": "목적어 엔티티의 유형. object_id가 null이면 null.",
      "enum": ["agent", "concept", "block", null],
      "default": null
    },
    "object_value": {
      "type": ["string", "null"],
      "description": "자유 텍스트 목적어. 엔티티로 정의되지 않은 값. 예: 瑯邪臨沂",
      "default": null
    },
    "evidence_blocks": {
      "type": ["array", "null"],
      "description": "이 관계의 근거가 되는 TextBlock id 목록. operation-rules 4.2: 활성화 시 근거 검증 필요.",
      "items": {
        "type": "string",
        "format": "uuid"
      },
      "default": null
    },
    "confidence": {
      "type": ["number", "null"],
      "description": "관계 신뢰도. 0.0 ~ 1.0.",
      "minimum": 0.0,
      "maximum": 1.0,
      "default": null
    },
    "extractor": {
      "type": ["string", "null"],
      "description": "추출 주체. 예: llm, manual, regex",
      "default": null
    },
    "status": {
      "type": "string",
      "description": "엔티티 상태. (operation-rules 2.4)",
      "enum": ["draft", "active", "deprecated", "archived"]
    },
    "metadata": {
      "type": ["object", "null"],
      "description": "자유 형식 메타데이터.",
      "additionalProperties": true,
      "default": null
    }
  }
}
