# Phase 11-2: ë²ˆì—­ ì›Œí¬í”Œë¡œìš° + LLM (L6)

> Claude Code ì„¸ì…˜ ì§€ì‹œë¬¸
> ì´ ë¬¸ì„œë¥¼ ì½ê³  ì‘ì—… ìˆœì„œëŒ€ë¡œ êµ¬í˜„í•˜ë¼.

---

## ì‚¬ì „ ì¤€ë¹„

1. CLAUDE.mdë¥¼ ë¨¼ì € ì½ì–´ë¼.
2. docs/DECISIONS.mdë¥¼ ì½ì–´ë¼.
3. docs/phase11_12_design_decisions.mdë¥¼ ì½ì–´ë¼ â€” L6 ë²ˆì—­ ìŠ¤í‚¤ë§ˆê°€ ì •ì˜ë˜ì–´ ìˆë‹¤.
4. ì´ ë¬¸ì„œ ì „ì²´ë¥¼ ì½ì€ í›„ ì‘ì—…ì„ ì‹œì‘í•˜ë¼.
5. ê¸°ì¡´ ì½”ë“œ êµ¬ì¡°ë¥¼ ë¨¼ì € íŒŒì•…í•˜ë¼: `src/core/punctuation.py`ì˜ `split_sentences()`, `src/llm/router.py`.
6. **Phase 10-2ì˜ Draftâ†’Reviewâ†’Commit íŒ¨í„´ê³¼ Phase 11-1ì˜ LLM í‘œì  Draft íŒ¨í„´ì„ ì°¸ê³ í•˜ë¼.**

---

## ì„¤ê³„ ìš”ì•½ â€” ë°˜ë“œì‹œ ì´í•´í•œ í›„ êµ¬í˜„

### í•µì‹¬ ì›ì¹™

- **ë²ˆì—­ ë‹¨ìœ„ëŠ” ë¬¸ì¥**: L5 í‘œì (`split_sentences()`)ìœ¼ë¡œ ë‚˜ëˆˆ ë¬¸ì¥ì´ ê¸°ë³¸ ë‹¨ìœ„.
- **í‘œì  ì—†ìœ¼ë©´ ë¸”ë¡ ë‹¨ìœ„**: í‘œì  ë¯¸ì™„ë£Œ ì‹œ ë¸”ë¡ ì „ì²´ë¥¼ í•˜ë‚˜ì˜ ë¬¸ì¥ìœ¼ë¡œ ì·¨ê¸‰.
- **í˜„í† ëŠ” optional**: L5 í˜„í† ê°€ ìˆìœ¼ë©´ í”„ë¡¬í”„íŠ¸ì— í¬í•¨í•˜ì—¬ ë²ˆì—­ í’ˆì§ˆ í–¥ìƒ. ì—†ì–´ë„ ë²ˆì—­ ê°€ëŠ¥.
- **í•œêµ­ì–´ ê¸°ë³¸**: `target_language` í•„ë“œë¡œ í–¥í›„ ë‹¤êµ­ì–´ í™•ì¥.
- **Draftâ†’Reviewâ†’Commit**: LLM ë²ˆì—­ ê²°ê³¼ëŠ” í•­ìƒ Draft. ì—°êµ¬ì ê²€í†  í›„ í™•ì •.
- **ìˆ˜ë™ ì…ë ¥ë„ ì§€ì›**: LLM ì—†ì´ ì§ì ‘ ë²ˆì—­ ì…ë ¥ ê°€ëŠ¥ (`translator.type: "human"`).

### L6 ë²ˆì—­ ë°ì´í„° ëª¨ë¸

```json
{
  "part_id": "vol1",
  "page_number": 1,
  "translations": [
    {
      "id": "tr_001",
      "source": {
        "block_id": "p01_b01",
        "start": 0,
        "end": 7
      },
      "source_text": "ç‹æˆç°¡è¦è£´æ¥·æ¸…é€š",
      "hyeonto_text": "ç‹æˆì€ç°¡è¦í•˜ê³ è£´æ¥·á…µæ¸…é€ší•˜ë‹ˆ",
      "target_language": "ko",
      "translation": "ì™•ìœµì€ ê°„ê²°í•˜ê³  ë°°í•´ëŠ” ë§‘ê³  í†µë‹¬í•˜ì˜€ë‹¤.",
      "translator": {
        "type": "llm",
        "model": "qwen3-vl:235b-cloud",
        "draft_id": "draft_xxx"
      },
      "status": "draft",
      "reviewed_by": null,
      "reviewed_at": null
    }
  ]
}
```

í•„ë“œ ì„¤ëª…:
- `source`: L4 í…ìŠ¤íŠ¸ì˜ ë²”ìœ„ ì°¸ì¡° (í‘œì ìœ¼ë¡œ ë‚˜ëˆˆ ë¬¸ì¥ ê²½ê³„ì™€ ì¼ì¹˜)
- `source_text`: ì›ë¬¸ ìŠ¤ëƒ…ìƒ· â€” L4 ë³€ê²½ ì‹œ ë¹„êµìš© (ê²½ê³  íŠ¸ë¦¬ê±°)
- `hyeonto_text`: í˜„í†  ì ìš©ëœ í…ìŠ¤íŠ¸ ìŠ¤ëƒ…ìƒ· â€” null ê°€ëŠ¥
- `translator.type`: "llm" ë˜ëŠ” "human"
- `status`: "draft" â†’ "reviewed" â†’ "accepted"

### ë²ˆì—­ íë¦„

```
1. ì‚¬ìš©ìê°€ [ë²ˆì—­] ëª¨ë“œì—ì„œ ë¸”ë¡ ì„ íƒ
2. split_sentences()ë¡œ ë¬¸ì¥ ë¶„ë¦¬ (í‘œì  ìˆìœ¼ë©´)
3. ê° ë¬¸ì¥ì— ëŒ€í•´:
   a. ì›ë¬¸ + (optional) í˜„í†  í…ìŠ¤íŠ¸ ì¤€ë¹„
   b. LlmRouter.generate()ë¡œ ë²ˆì—­ Draft ìƒì„±
   c. Draft ìƒíƒœë¡œ ì €ì¥
4. ì‚¬ìš©ìê°€ Draftë¥¼ ê²€í† /ìˆ˜ì •
5. í™•ì • ì‹œ status â†’ "accepted", git commit
```

---

## ì‘ì—… ìˆœì„œ

### ì‘ì—… 1: L6 ìŠ¤í‚¤ë§ˆ íŒŒì¼ ìƒì„±

```
schemas/interp/translation_page.schema.json
```

ìœ„ì˜ ë°ì´í„° ëª¨ë¸ì„ JSON Schemaë¡œ ì •ì˜í•œë‹¤.

í…ŒìŠ¤íŠ¸: ì˜ˆì‹œ JSONìœ¼ë¡œ ê²€ì¦ í†µê³¼ í™•ì¸.

ì»¤ë°‹: `feat: L6 ë²ˆì—­ JSON Schema ì •ì˜`

### ì‘ì—… 2: ë²ˆì—­ í”„ë¡¬í”„íŠ¸

```
src/llm/prompts/translation.yaml
```

```yaml
id: translation_classical_chinese_v1

system: |
  ë‹¹ì‹ ì€ í•œë¬¸ ê³ ì „ í…ìŠ¤íŠ¸ë¥¼ í˜„ëŒ€ í•œêµ­ì–´ë¡œ ë²ˆì—­í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
  ì›ë¬¸ì˜ ëœ»ì„ ì •í™•íˆ ì „ë‹¬í•˜ë©´ì„œë„ ìì—°ìŠ¤ëŸ¬ìš´ í•œêµ­ì–´ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
  ë²ˆì—­ë§Œ ì¶œë ¥í•˜ì„¸ìš”. ë¶€ê°€ ì„¤ëª…ì´ë‚˜ ì£¼ì„ì„ ë‹¬ì§€ ë§ˆì„¸ìš”.

user_template: |
  ë‹¤ìŒ í•œë¬¸ ì›ë¬¸ì„ í˜„ëŒ€ í•œêµ­ì–´ë¡œ ë²ˆì—­í•˜ì„¸ìš”.
  
  ì›ë¬¸: {original_text}
  {hyeonto_section}
  ë§¥ë½: {context}
  
  ë²ˆì—­:

# hyeonto_sectionì€ í˜„í† ê°€ ìˆì„ ë•Œë§Œ ì‚½ì…:
# "í˜„í† : {hyeonto_text}  (ì°¸ê³ ìš©)"
```

ì»¤ë°‹: `feat: í•œë¬¸â†’í•œêµ­ì–´ ë²ˆì—­ í”„ë¡¬í”„íŠ¸`

### ì‘ì—… 3: ë²ˆì—­ ì½”ì–´ ë¡œì§

```
src/core/translation.py
```

êµ¬í˜„í•  í•¨ìˆ˜:

- `load_translations(work_path, interp_id, part_id, page_number) â†’ dict`: L6 ë²ˆì—­ íŒŒì¼ ë¡œë“œ
- `save_translations(work_path, interp_id, part_id, page_number, data) â†’ None`: ìŠ¤í‚¤ë§ˆ ê²€ì¦ í›„ ì €ì¥
- `add_translation(data, translation_entry) â†’ dict`: ë²ˆì—­ ì¶”ê°€ (id ìë™ ìƒì„±)
- `update_translation(data, translation_id, updates) â†’ dict`: ë²ˆì—­ ìˆ˜ì •
- `remove_translation(data, translation_id) â†’ dict`: ë²ˆì—­ ì‚­ì œ
- `get_translation_status(data) â†’ dict`: ë¸”ë¡/ë¬¸ì¥ë³„ ë²ˆì—­ ìƒíƒœ ìš”ì•½ (ë¯¸ë²ˆì—­/draft/accepted)

ì»¤ë°‹: `feat: L6 ë²ˆì—­ ì½”ì–´ ë¡œì§`

### ì‘ì—… 4: LLM ë²ˆì—­ Draft ìƒì„±

```
src/core/translation_llm.py
```

êµ¬í˜„í•  í•¨ìˆ˜:

- `generate_translation_draft(work_path, interp_id, part_id, page_number, block_id, target_language="ko") â†’ list[LlmDraft]`
  - L4ì—ì„œ ì›ë¬¸ ë¡œë“œ
  - L5 í‘œì ì´ ìˆìœ¼ë©´ split_sentences()ë¡œ ë¬¸ì¥ ë¶„ë¦¬, ì—†ìœ¼ë©´ ë¸”ë¡ ì „ì²´
  - L5 í˜„í† ê°€ ìˆìœ¼ë©´ render_hyeonto_text()ë¡œ í•©ì„± í…ìŠ¤íŠ¸ ì¤€ë¹„
  - ë§¥ë½: ì•ë’¤ ë¸”ë¡ì˜ ì›ë¬¸ (reading_order ê¸°ì¤€)
  - ê° ë¬¸ì¥ë§ˆë‹¤ LlmRouter.generate()
  - ê²°ê³¼ë¥¼ L6 í˜•ì‹ìœ¼ë¡œ ë³€í™˜, Draft ìƒíƒœë¡œ ì €ì¥

- `commit_translation_draft(work_path, interp_id, part_id, page_number, draft_id, modifications) â†’ None`
  - ìˆ˜ì • ì‚¬í•­ ë°˜ì˜
  - status â†’ "accepted"
  - translation_page.json ì €ì¥ + git commit

í…ŒìŠ¤íŠ¸: è’™æ±‚ ì²« êµ¬ì ˆë¡œ LLM ë²ˆì—­ ìƒì„± í…ŒìŠ¤íŠ¸ (LLM ë¯¸ì—°ê²° ì‹œ mock).

ì»¤ë°‹: `feat: LLM ë²ˆì—­ Draft ìƒì„± ë¡œì§`

### ì‘ì—… 5: API ì—”ë“œí¬ì¸íŠ¸

```python
# src/api/translation.py

# ë²ˆì—­ ì¡°íšŒ
GET /api/interpretations/{interp_id}/pages/{page}/translation
  â†’ 200: translation_page.json ë‚´ìš©

# ë²ˆì—­ ìƒíƒœ ìš”ì•½
GET /api/interpretations/{interp_id}/pages/{page}/translation/status
  â†’ 200: { "total_sentences": 10, "draft": 3, "accepted": 5, "untranslated": 2 }

# LLM ë²ˆì—­ Draft ìƒì„± (ë¸”ë¡ ë‹¨ìœ„)
POST /api/interpretations/{interp_id}/pages/{page}/translate
  ì…ë ¥: { "block_ids": ["p01_b01"], "target_language": "ko" }
  â†’ 200: { "drafts": [...] }

# ìˆ˜ë™ ë²ˆì—­ ì…ë ¥
POST /api/interpretations/{interp_id}/pages/{page}/translation
  ì…ë ¥: { "source": {"block_id": "...", "start": 0, "end": 7}, "translation": "...", "target_language": "ko" }
  â†’ 201: ìƒì„±ëœ ë²ˆì—­ (id í¬í•¨, translator.type = "human", status = "accepted")

# ë²ˆì—­ ìˆ˜ì •
PUT /api/interpretations/{interp_id}/pages/{page}/translation/{translation_id}
  ì…ë ¥: { "translation": "ìˆ˜ì •ëœ ë²ˆì—­", "status": "accepted" }
  â†’ 200

# Draft í™•ì •
POST /api/interpretations/{interp_id}/pages/{page}/translation/{draft_id}/commit
  ì…ë ¥: { "modifications": {"translation": "ìˆ˜ì •ëœ ë²ˆì—­"} }
  â†’ 200
```

ì»¤ë°‹: `feat: L6 ë²ˆì—­ API ì—”ë“œí¬ì¸íŠ¸`

### ì‘ì—… 6: GUI â€” ë²ˆì—­ í¸ì§‘ê¸°

ì‘ì—… ëª¨ë“œ íƒ­ì— [ë²ˆì—­] ì¶”ê°€:

```
[ì—´ëŒ] [ë ˆì´ì•„ì›ƒ] [êµì •] [í‘œì ] [í˜„í† ] [ë²ˆì—­]
                                        â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ ì¢Œ: ì›ë¬¸ + í‘œì  + í˜„í†                                       â”‚
         â”‚   "ç‹æˆì€ç°¡è¦í•˜ê³ ï¼Œè£´æ¥·á…µæ¸…é€ší•˜ë‹ˆã€‚"                          â”‚
         â”‚                                                              â”‚
         â”‚ ìš°: ë²ˆì—­                                                     â”‚
         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚   â”‚ ë¬¸ì¥ 1: "ç‹æˆç°¡è¦è£´æ¥·æ¸…é€š"                            â”‚  â”‚
         â”‚   â”‚ [AI ë²ˆì—­] [ìˆ˜ë™ ì…ë ¥]                                 â”‚  â”‚
         â”‚   â”‚                                                       â”‚  â”‚
         â”‚   â”‚ "ì™•ìœµì€ ê°„ê²°í•˜ê³  ë°°í•´ëŠ” ë§‘ê³  í†µë‹¬í•˜ì˜€ë‹¤."              â”‚  â”‚
         â”‚   â”‚                                                       â”‚  â”‚
         â”‚   â”‚ ìƒíƒœ: [draft â–¼]  [âœ… ìŠ¹ì¸] [âœï¸ ìˆ˜ì •] [ğŸ”„ ì¬ìƒì„±]     â”‚  â”‚
         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚                                                              â”‚
         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚   â”‚ ë¬¸ì¥ 2: "å­”æ˜è‡¥é¾å‘‚æœ›éç†Š"                            â”‚  â”‚
         â”‚   â”‚ [ë¯¸ë²ˆì—­]                                              â”‚  â”‚
         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚                                                              â”‚
         â”‚ [ì „ì²´ AI ë²ˆì—­] [ì €ì¥]                                        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

êµ¬í˜„ ì‚¬í•­:
- ì¢Œì¸¡: ì›ë¬¸ + í‘œì  + í˜„í†  í•©ì„± í…ìŠ¤íŠ¸ (ì½ê¸° ì „ìš©)
- ìš°ì¸¡: ë¬¸ì¥ë³„ ë²ˆì—­ ì¹´ë“œ
- ê° ì¹´ë“œì— ìƒíƒœ í‘œì‹œ: ë¯¸ë²ˆì—­ / draft / accepted
- [AI ë²ˆì—­] â†’ í•´ë‹¹ ë¬¸ì¥ LLM Draft ìƒì„±
- [ì „ì²´ AI ë²ˆì—­] â†’ í˜ì´ì§€ì˜ ë¯¸ë²ˆì—­ ë¬¸ì¥ ì „ë¶€ LLM Draft ìƒì„±
- [ìˆ˜ë™ ì…ë ¥] â†’ í…ìŠ¤íŠ¸ ì˜ì—­ í™œì„±í™”, translator.type = "human"
- Draft ë¦¬ë·° UI: Phase 10-2 íŒ¨í„´ ì¬ì‚¬ìš©

ì»¤ë°‹: `feat: L6 ë²ˆì—­ í¸ì§‘ê¸° GUI`

### ì‘ì—… 7: í†µí•© í…ŒìŠ¤íŠ¸

í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ (è’™æ±‚ ì²« êµ¬ì ˆ):

1. L5 í‘œì ì´ ìˆëŠ” ìƒíƒœì—ì„œ [ë²ˆì—­] ëª¨ë“œ ì§„ì…
2. ë¬¸ì¥ë³„ë¡œ ë¶„ë¦¬ë˜ì–´ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
3. [AI ë²ˆì—­] â†’ Draft ìƒì„± í™•ì¸
4. Draft ìˆ˜ì • í›„ ìŠ¹ì¸ â†’ status "accepted" í™•ì¸
5. ìˆ˜ë™ ë²ˆì—­ ì…ë ¥ â†’ translator.type "human" í™•ì¸
6. translation_page.json ì €ì¥ + git commit í™•ì¸
7. í‘œì  ì—†ëŠ” ë¸”ë¡ì—ì„œë„ ë²ˆì—­ ê°€ëŠ¥í•œì§€ í™•ì¸ (ë¸”ë¡ ë‹¨ìœ„ í´ë°±)

ì»¤ë°‹: `test: L6 ë²ˆì—­ í†µí•© í…ŒìŠ¤íŠ¸`

---

## ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] schemas/interp/translation_page.schema.json ìƒì„±
- [ ] src/llm/prompts/translation.yaml â€” ë²ˆì—­ í”„ë¡¬í”„íŠ¸
- [ ] src/core/translation.py â€” ë²ˆì—­ CRUD + ìƒíƒœ ê´€ë¦¬
- [ ] src/core/translation_llm.py â€” LLM ë²ˆì—­ Draft ìƒì„±
- [ ] src/api/translation.py â€” ë²ˆì—­ API ì—”ë“œí¬ì¸íŠ¸
- [ ] GUIì— [ë²ˆì—­] ëª¨ë“œ íƒ­ + ë²ˆì—­ í¸ì§‘ê¸°
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ í†µê³¼

---

## â­ï¸ ë‹¤ìŒ ì„¸ì…˜: Phase 11-3 â€” ì£¼ì„/ì‚¬ì „ ì—°ë™ (L7)

```
ì´ ì„¸ì…˜(11-2)ì´ ì™„ë£Œë˜ë©´ ë‹¤ìŒ ì‘ì—…ì€ Phase 11-3 â€” ì£¼ì„/ì‚¬ì „ ì—°ë™ì´ë‹¤.

11-2ì—ì„œ ë§Œë“  ê²ƒ:
  âœ… L6 ë²ˆì—­ ìŠ¤í‚¤ë§ˆ + ì½”ì–´ ë¡œì§ + API + GUI
  âœ… LLM ë²ˆì—­ Draft ìƒì„± (ë¬¸ì¥ ë‹¨ìœ„)
  âœ… ìˆ˜ë™ ë²ˆì—­ ì…ë ¥

11-3ì—ì„œ ë§Œë“¤ ê²ƒ:
  - L7 ì£¼ì„ ìŠ¤í‚¤ë§ˆ + ì½”ì–´ ë¡œì§
  - ì£¼ì„ ìœ í˜• ê´€ë¦¬ (ì‚¬ìš©ì ì •ì˜ ê°€ëŠ¥)
  - LLM ìë™ íƒœê¹… (ì›ë¬¸ ì „ì²´ â†’ í•œë²ˆì—)
  - ì£¼ì„ í¸ì§‘ê¸° GUI

ì„¸ì…˜ ë¬¸ì„œ: phase11_3_annotation_session.md
ì‚¬ì „ ì¤€ë¹„:
  - ì£¼ì„ ìœ í˜• ê¸°ë³¸ í”„ë¦¬ì…‹ í™•ì¸ (person, place, term, allusion, note)
  - ì´ˆê¸° í…ŒìŠ¤íŠ¸ ë°ì´í„° (è’™æ±‚ ì¸ë¬¼ ë“±)
```
