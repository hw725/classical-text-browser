# 사용자 가이드 — 고전 텍스트 디지털 서고 플랫폼

> 이 문서는 **처음 사용하는 연구자**를 위한 단계별 안내서입니다.
> 프로그래밍 지식은 필요하지 않습니다.

---

## 목차

1. [이 프로그램은 무엇인가](#1-이-프로그램은-무엇인가)
2. [설치와 실행](#2-설치와-실행)
3. [화면 구성 이해하기](#3-화면-구성-이해하기)
4. [시작하기: 첫 문헌 등록](#4-시작하기-첫-문헌-등록)
5. [작업 흐름 1: 이미지에서 텍스트 만들기](#5-작업-흐름-1-이미지에서-텍스트-만들기)
6. [작업 흐름 2: 텍스트 해석하기](#6-작업-흐름-2-텍스트-해석하기)
7. [작업 흐름 3: 연구 도구 활용하기](#7-작업-흐름-3-연구-도구-활용하기)
8. [LLM 설정 안내](#8-llm-설정-안내)
9. [서고 관리](#9-서고-관리)
10. [자주 묻는 질문](#10-자주-묻는-질문)

---

## 1. 이 프로그램은 무엇인가

개발자에게 VSCode가 있듯이, **고전 텍스트 연구자에게는 이 플랫폼**이 있습니다.

하나의 화면에서:
- 원본 이미지(PDF/스캔본)를 보면서
- 글자를 읽어내고(OCR)
- 교정하고
- 표점(구두점)을 찍고
- 현토를 달고
- 번역하고
- 주석을 붙이고
- 논문 인용을 준비할 수 있습니다.

**모든 작업 이력이 자동으로 기록**됩니다 (Git 기반). 이전 버전으로 되돌리거나, 다른 연구자와 작업을 공유할 수 있습니다.

### 핵심 개념: 8층 데이터 모델

데이터는 8개 층으로 구분됩니다. 아래에서 위로 쌓아올리는 구조입니다.

```
 원본 저장소 (변경 불가)          해석 저장소 (연구자의 작업)
┌─────────────────────┐       ┌──────────────────────────┐
│ L1  원본 PDF/이미지  │       │ L5  표점(句讀) · 현토     │
│ L2  OCR 인식 결과    │  ───→ │ L6  번역                  │
│ L3  레이아웃 분석    │       │ L7  주석 · 사전           │
│ L4  교정 텍스트      │       │ L8  관계 그래프 (예정)    │
└─────────────────────┘       └──────────────────────────┘
```

- **원본 저장소**(L1~L4)는 문헌 자체의 디지털화 작업입니다
- **해석 저장소**(L5~L8)는 연구자의 해석 작업입니다
- 두 저장소는 독립적이므로, 하나의 원본에 여러 해석을 붙일 수 있습니다 (예: 내 번역 vs LLM 번역)

---

## 2. 설치와 실행

### 2.1 사전 요구 사항

- **Python 3.10 이상** (Python이 없다면 [python.org](https://www.python.org)에서 설치)
- **Git** ([git-scm.com](https://git-scm.com)에서 설치)
- **uv** (Python 패키지 관리자):
  ```bash
  # Windows (PowerShell)
  irm https://astral.sh/uv/install.ps1 | iex

  # macOS/Linux
  curl -LsSf https://astral.sh/uv/install.sh | sh
  ```

### 2.2 설치

```bash
# 1. 소스 코드 다운로드
git clone https://github.com/hw725/classical-text-platform.git
cd classical-text-platform

# 2. 의존성 설치 (자동으로 가상환경 생성)
uv sync

# 3. (선택) 오프라인 OCR 엔진 설치 (~500MB)
uv sync --extra paddleocr

# 주의: PaddleOCR은 개별 설치 권장
# Windows + Python 3.13 + PaddlePaddle 3.x(CPU) 조합에서는 실행 충돌 가능
```

### 2.3 서버 실행

```bash
# 서고가 이미 있는 경우:
uv run python -m app serve --library /path/to/my-library

# 서고가 없는 경우 (GUI에서 나중에 설정):
uv run python -m app serve
```

실행 후 **브라우저에서 `http://localhost:8765`**를 엽니다.

### 2.4 서고 만들기 (처음일 때)

CLI로 서고를 먼저 만들 수도 있습니다:
```bash
uv run python -m cli init-library /path/to/my-library
```

또는 GUI 설정 탭에서 "새 서고" 버튼을 누릅니다 ([9. 서고 관리](#9-서고-관리) 참조).

---

## 3. 화면 구성 이해하기

화면은 크게 4개 영역으로 나뉩니다.

```
┌────┬─────────┬─── 모드 탭 ────────────────────────────────────┐
│액  │         │ [열람] [레이아웃] [교정] [편성] [표점] ...      │
│티  │ 사이드  ├─────────────────┬────────────────────────────────┤
│비  │ 바      │                 │                                │
│티  │         │   PDF 뷰어      │      에디터 패널               │
│바  │ 문헌    │   (원본 이미지)  │   (모드에 따라 내용 변경)      │
│    │ 목록    │                 │                                │
│    │         │                 │                                │
│    │         ├─────────────────┴────────────────────────────────┤
│    │         │ 하단 패널: [Git이력] [검증] [의존] [엔티티] [비고] │
└────┴─────────┴─────────────────────────────────────────────────┘
```

### 3.1 액티비티 바 (맨 왼쪽, 아이콘 세로줄)

| 위치 | 아이콘 | 기능 |
|------|--------|------|
| 상단 | 폴더 | **서고 브라우저** — 문헌 목록, 서지정보, 해석 저장소 |
| 하단 | 해/달 | **테마 전환** — 밝은 모드 / 어두운 모드 |
| 하단 | 톱니바퀴 | **설정** — 서고 경로 변경, 최근 서고 |

> **팁**: 같은 아이콘을 다시 클릭하면 사이드바가 접힙니다. 넓은 화면이 필요할 때 유용합니다.

### 3.2 사이드바

**서고 브라우저** 모드일 때 세 섹션이 표시됩니다:

1. **문헌 목록** — 서고에 등록된 모든 문헌. 트리 형태로 권(卷)→페이지 탐색
2. **서지정보** — 선택한 문헌의 제목·저자·시기 등 메타데이터
3. **해석 저장소** — 선택한 문헌에 연결된 해석 작업 목록

### 3.3 모드 탭 바

작업 종류에 따라 10개 모드를 전환합니다. **왼쪽에서 오른쪽으로 작업 순서**입니다.

| 모드 | 층 | 하는 일 |
|------|-----|---------|
| **열람** | L1~L4 | PDF 보기 + 텍스트 읽기 (기본 모드) |
| **레이아웃** | L3 | 이미지에서 텍스트 영역 지정 (본문 / 주석 / 제목 구분) |
| **교정** | L4 | OCR 결과를 글자 단위로 교정 |
| **편성** | L3→L5 | 레이아웃 블록을 해석 단위로 묶기 |
| **표점** | L5 | 한문에 구두점(。、；) 삽입 |
| **현토** | L5 | 한문에 한국어 토(은, 하고, 이니) 삽입 |
| **번역** | L6 | 문장별 현대어 번역 |
| **주석** | L7 | 인물·지명·용어·전거 주석 |
| **인용** | — | 논문 인용 구절 마크업 + 학술 인용 형식 내보내기 |
| **교차뷰어** | L5~L7 | 표점·번역·주석을 한눈에 통합 열람 |

### 3.4 메인 영역 (좌우 분할)

- **왼쪽**: PDF/이미지 뷰어 (원본 열람)
- **오른쪽**: 에디터 패널 (모드에 따라 내용이 바뀜)
- 경계선을 드래그하여 비율 조절 가능

### 3.5 하단 패널

| 탭 | 용도 |
|----|------|
| **Git 이력** | 작업 저장 이력 보기, 사다리형 그래프 |
| **검증** | 데이터 무결성 검사 결과 (예정) |
| **의존** | 원본이 변경되었는지 추적 |
| **엔티티** | TextBlock, Tag, Concept 등 코어 엔티티 |
| **비고** | 자유 메모 |

---

## 4. 시작하기: 첫 문헌 등록

### 방법 A: URL로 등록 (권장)

1. 사이드바 상단의 **"+ 새 문헌"** 클릭
2. **URL 입력** — 지원하는 서지정보 소스:
   - 한국고문헌종합목록(KORCIS) URL
   - 일본 국립국회도서관(NDL Search) URL
   - 일본 국립공문서관 디지털 아카이브 URL
   - 기타 모든 URL (범용 LLM 파서 사용)
3. 시스템이 자동으로:
   - 서지정보를 파싱하여 제목·저자·시기를 채움
   - PDF/이미지가 있으면 자동 다운로드 제안
4. **"등록"** 클릭하면 서고에 문헌이 추가됩니다

### 방법 B: CLI로 등록

```bash
uv run python -m cli add-document /path/to/my-library \
    --title "蒙求" --doc-id monggu
```

등록 후 PDF 파일을 `documents/monggu/L1_source/` 폴더에 직접 복사합니다.

### 방법 C: HWP/HWPX 가져오기

1. 사이드바의 **"HWP"** 버튼 클릭
2. 한글 파일(.hwp 또는 .hwpx) 선택
3. 미리보기에서 옵션 설정:
   - **표점·현토 자동 분리**: 한문 원문에서 구두점과 토를 자동 분리
   - **대두(擡頭) 감지**: 줄바꿈 형식 메타데이터 추출
4. **"가져오기"** 클릭

---

## 5. 작업 흐름 1: 이미지에서 텍스트 만들기

> PDF/이미지 원본이 있는 문헌에 해당합니다.
> HWP에서 텍스트를 가져왔다면 이 단계를 건너뛸 수 있습니다.

### 5.1 레이아웃 분석 (L3)

**목적**: 페이지 이미지에서 "어디에 무슨 종류의 글자가 있는지" 지정합니다.

1. **레이아웃** 모드 탭 선택
2. **"AI 분석"** 버튼 클릭 → LLM이 자동으로 영역을 감지합니다
3. 결과를 확인합니다:
   - 초록색 박스 = 본문(大字)
   - 파란색 박스 = 주석(小字雙行)
   - 회색 박스 = 판심제, 장차 등
4. **잘못된 박스 수정**:
   - 박스 클릭 → 오른쪽 패널에서 속성(유형, 읽기 순서) 변경
   - 박스 드래그로 위치/크기 조정
   - 새 박스 추가 또는 삭제
5. **저장** (Ctrl+S 또는 저장 버튼)

> **읽기 순서(reading_order)**: OCR이 블록을 읽는 순서입니다. 고전 한문은 보통 오른쪽에서 왼쪽(세로쓰기, RTL)이므로 오른쪽 블록에 작은 번호를 부여합니다.

### 5.2 OCR (L2)

**목적**: 각 블록의 이미지를 글자로 변환합니다.

1. **레이아웃** 모드에서 우측 하단의 **OCR 실행** 패널 확인
2. 설정:
   - **엔진**: PaddleOCR(오프라인) 또는 LLM 비전(온라인)
   - **모델**: auto(자동 폴백) 또는 특정 모델 선택
   - **언어**: classical_chinese(고전 한문)
3. **"전체 OCR"** 클릭 → 모든 블록을 순서대로 OCR
   - 또는 특정 블록만 선택하여 **"선택 OCR"**
4. 진행률 표시줄에서 진행 상황 확인
5. 완료 후 결과 미리보기

### 5.3 교정 (L4)

**목적**: OCR이 잘못 읽은 글자를 바로잡습니다.

1. **교정** 모드 탭 선택
2. **"OCR 채우기"** 클릭 → OCR 결과를 교정 편집기에 불러옵니다
3. 왼쪽 PDF 이미지와 비교하면서 글자를 수정합니다
   - 틀린 글자를 클릭 → 올바른 글자 입력
   - 교정 유형 지정: OCR 오류 / 이체자 / 해독 불가 등
4. **대조** 서브탭: OCR 결과와 교정본을 글자별로 나란히 비교
   - 빨간색 = 불일치, 초록색 = 일치, 노란색 = 이체자
5. **저장** (Ctrl+S)

---

## 6. 작업 흐름 2: 텍스트 해석하기

> 해석 작업을 시작하려면 먼저 **해석 저장소를 생성**해야 합니다.
> 사이드바 "해석 저장소" 섹션에서 **"새로 만들기"**를 클릭합니다.

### 6.1 표점 (L5) — 한문에 구두점 삽입

1. **표점** 모드 탭 선택
2. 상단에서 블록 선택
3. 글자를 클릭하면 **표점 부호 팔레트**가 나타납니다
   - 기본 부호: 。 、 ， ； ： ？ ！ 《》
4. 부호를 선택하면 해당 글자 뒤에 삽입됩니다
   - 서명호(《》)는 범위 선택 필요
5. **"AI 표점"**: LLM이 자동으로 구두점을 제안합니다 → 검토 후 확정
6. **저장**

### 6.2 현토 (L5) — 한국어 토 달기

1. **현토** 모드 탭 선택
2. 글자를 클릭하면 **현토 입력 팝업**이 나타납니다
   - **위치**: before(글자 앞) 또는 after(글자 뒤)
   - **토**: 한국어 토 입력 (예: 은, 이, 하고, 이니)
3. **삽입** 클릭
4. **저장**

### 6.3 번역 (L6) — 현대어 번역

1. **번역** 모드 탭 선택
2. 상단에서 블록 선택
3. 원문이 표시되고 (표점·현토 적용된 상태), 아래에 문장별 번역 입력란이 나타납니다
4. 직접 번역을 입력하거나 **"전체 AI 번역"** 클릭
   - LLM이 문장별로 초안을 생성합니다
   - 초안(draft)을 검토하고 수정합니다
5. **참조 사전 활용**:
   - **"참조사전 ON"** 토글 → 주석에서 만든 사전 항목이 번역에 참고됩니다
   - **"사전 관리"** → 다른 문헌에서 가져온 참조 사전 관리
6. **저장**

### 6.4 주석 (L7) — 인물·지명·용어·전거

1. **주석** 모드 탭 선택
2. 상단에서 블록 선택
3. 원문에서 주석할 범위를 드래그로 선택
4. 주석 유형 선택: 인물(person), 지명(place), 용어(term), 전거(allusion), 메모(note)
5. 내용 입력: 표제어, 설명, 참고문헌
6. **AI 태깅**: LLM이 자동으로 주석 후보를 생성합니다

#### 사전형 주석 (고급)

단순 태깅 외에 사전 형식의 체계적 주석을 만들 수 있습니다:

| 필드 | 설명 | 예시 |
|------|------|------|
| 표제어 | 한자 원문 | 王戎 |
| 독음 | 한국어 독음 | 왕융 |
| 사전적 의미 | 일반적 정의 | 서진의 관료, 죽림칠현의 한 사람 |
| 문맥적 의미 | 이 텍스트에서의 뜻 | 간결한 행정으로 유명한 인물의 예시 |
| 출전 | 참고문헌 | 《晉書》 列傳 第十三 |

**4단계 LLM 생성**:
1. **[1단계]**: 원문만으로 사전 항목 생성
2. **[2단계]**: 번역을 참고하여 보강
3. **[3단계]**: 원문+번역 통합하여 최종 생성
4. 연구자가 검토·편집 → **확정(accepted)**

확정된 주석은 LLM이 덮어쓰지 않습니다. 안심하고 편집하세요.

---

## 7. 작업 흐름 3: 연구 도구 활용하기

### 7.1 인용 마크

논문 인용을 위해 구절을 마크업합니다.

1. **인용** 모드 탭 선택
2. 원문 또는 번역에서 인용할 범위를 드래그로 선택
3. **"인용 마크 추가"** 클릭
4. 레이블(메모)과 태그(분류)를 붙일 수 있습니다
5. **통합 컨텍스트 뷰**: 마크된 구절에 대해 원문·표점본·번역·주석을 한눈에 확인
6. **"내보내기"**: 학술 인용 형식으로 변환, 클립보드에 복사

인용 형식 예시:
```
朴趾源, 燕岩集卷2, 答巡使書 25면(韓國文集叢刊252집, 48면) : 若吾所樂者善，而所敬者天也。
```

### 7.2 사전 내보내기/가져오기

하나의 문헌에서 만든 주석 사전을 다른 문헌에서 참조할 수 있습니다.

1. **주석** 모드 → **"내보내기"** 클릭 → JSON 파일 저장
2. 다른 해석 저장소에서 **"사전 관리"** → **"가져오기"** → JSON 파일 선택
3. 가져온 사전의 표제어가 원문에서 자동 매칭됩니다
4. 매칭 결과를 체크박스로 선택 → 번역 프롬프트에 참고 사전으로 포함

### 7.3 교차 뷰어

모든 해석을 한 화면에서 확인합니다.

1. **교차뷰어** 모드 탭 선택
2. 상단 탭에서 L5(표점)·L6(번역)·L7(주석)을 전환
3. 본문/주석 토글로 본문 해석과 주석 해석을 구분하여 확인

### 7.4 Git 이력 관리

모든 저장은 자동으로 Git 커밋으로 기록됩니다.

1. **하단 패널** → **"Git 이력"** 탭 선택
2. **커밋 목록**: 최근 저장 이력을 시간순으로 보여줍니다
3. **사다리형 그래프**: 원본 저장소와 해석 저장소의 이력을 나란히 비교합니다
   - 가로 연결선은 "이 해석이 원본의 어떤 시점을 기반했는지"를 보여줍니다

### 7.5 JSON 스냅샷 내보내기/가져오기

문헌의 현재 상태를 단일 JSON 파일로 저장하거나, 다른 환경에서 가져올 수 있습니다.

- **내보내기**: 사이드바 해석 저장소 → 선택 → "JSON 내보내기"
- **가져오기**: 사이드바 해석 저장소 → "가져오기" → JSON 파일 선택

---

## 8. LLM 설정 안내

이 플랫폼은 여러 LLM 프로바이더를 지원합니다. 설정하지 않아도 기본 폴백이 동작하지만, API 키를 설정하면 더 좋은 품질을 얻을 수 있습니다.

### 8.1 프로바이더 목록

| 순위 | 프로바이더 | 설정 방법 | 비전(이미지) | 비용 |
|------|-----------|----------|-------------|------|
| 1 | Ollama (로컬/클라우드) | 자동 감지 (`localhost:11434`) | 모델 의존 | 무료 |
| 2 | Base44 Bridge | 자동 (Node.js 필요) | O | 무료 |
| 3 | Anthropic (Claude) | 환경변수 `ANTHROPIC_API_KEY` | O | 유료 |
| 4 | Gemini (Google) | 환경변수 `GEMINI_API_KEY` | O | 유료 |
| 5 | OpenAI | 환경변수 `OPENAI_API_KEY` | O | 유료 |

### 8.2 API 키 설정

서고 폴더에 `.env` 파일을 만듭니다:

```
ANTHROPIC_API_KEY=sk-ant-...
GEMINI_API_KEY=AI...
OPENAI_API_KEY=sk-...
```

또는 시스템 환경변수로 설정할 수도 있습니다.

### 8.3 비전 모델

OCR과 레이아웃 분석은 **이미지를 볼 수 있는 모델**만 사용할 수 있습니다. 드롭다운에서 모델 옆에 눈(👁) 아이콘이 있으면 비전을 지원합니다.

### 8.4 모델 선택 팁

- **오프라인 작업**: PaddleOCR(OCR용) + 필요 없음(해석은 수동)
- **기본 사용**: Ollama + 무료 모델(qwen3 등)
- **고품질 필요**: Anthropic(Claude) 또는 Gemini

---

## 9. 서고 관리

### 9.1 서고란?

"서고(Library)"는 여러 문헌과 해석 저장소를 묶어 관리하는 최상위 폴더입니다.

```
내_서고/
├── documents/           # 문헌들 (원본 저장소)
│   ├── monggu/          #   예: 蒙求
│   └── cheonjamun/      #   예: 千字文
├── interpretations/     # 해석 저장소들
│   ├── monggu_interp/   #   예: 蒙求 해석
│   └── ...
├── resources/           # 공유 리소스 (이체자 사전, 주석 유형 등)
└── .trash/              # 휴지통 (삭제된 항목)
```

### 9.2 서고 전환

1. 액티비티 바에서 **톱니바퀴(설정)** 클릭
2. **서고 경로** 옆의 **"편집"** 클릭
3. 새 경로를 입력하고 **"변경"** 클릭
4. 페이지가 새로고침되며 새 서고로 전환됩니다

**최근 서고**: 이전에 사용한 서고 목록이 표시됩니다. 클릭하면 바로 전환됩니다.

### 9.3 새 서고 만들기

1. 설정 탭에서 **"새 서고"** 클릭
2. 경로 입력 (예: `C:\연구\조선시대_문집`)
3. 기본 폴더 구조가 자동으로 생성됩니다

### 9.4 문헌/해석 삭제와 복원

**삭제**: 사이드바에서 문헌 또는 해석 저장소 선택 → 삭제 버튼
- 영구 삭제가 아닙니다! `.trash/` 폴더로 이동합니다
- 해당 문헌을 참조하는 해석 저장소가 있으면 경고를 표시합니다

**복원**: 설정 → 휴지통 → 복원할 항목 선택 → "복원"

---

## 10. 자주 묻는 질문

### Q. 인터넷이 없어도 사용할 수 있나요?

**네.** 핵심 기능(PDF 보기, 텍스트 편집, 교정, 표점, 현토)은 완전히 오프라인에서 동작합니다.
LLM 기능을 오프라인에서 쓰려면 PaddleOCR(OCR용) 또는 Ollama 로컬 모델을 설치하세요.

### Q. Git을 알아야 하나요?

**아니요.** Git은 내부적으로 자동 관리됩니다. 연구자는 "저장" 버튼만 누르면 됩니다. 이전 버전 보기, 변경 이력 추적도 GUI에서 할 수 있습니다.

### Q. 원본 파일이 변경되지는 않나요?

**절대 변경되지 않습니다.** L1(원본 PDF/이미지)은 시스템이 읽기 전용으로 보호합니다. 모든 작업(OCR, 교정, 번역 등)은 별도의 파일에 저장됩니다.

### Q. 같은 문헌에 여러 해석을 만들 수 있나요?

**네.** 하나의 원본 저장소에 여러 해석 저장소를 연결할 수 있습니다. 예를 들어 "내 번역"과 "LLM 번역"을 따로 만들어 비교할 수 있습니다.

### Q. LLM이 생성한 결과를 반드시 사용해야 하나요?

**아니요.** LLM 결과는 항상 "초안(draft)" 상태로 생성됩니다. 연구자가 검토하여 수정·확정·거부할 수 있습니다. 확정된 내용은 LLM이 덮어쓰지 않습니다.

### Q. 작업 데이터는 어디에 저장되나요?

서고 폴더 안에 모두 저장됩니다. 클라우드에 자동 전송되지 않습니다. 원한다면 GitHub 등 원격 저장소에 수동으로 동기화할 수 있습니다.

### Q. 어떤 순서로 작업해야 하나요?

권장 순서: **레이아웃 → OCR → 교정 → (편성 →) 표점 → 현토 → 번역 → 주석**

단, 이 순서가 필수는 아닙니다:
- HWP에서 텍스트를 가져왔다면 레이아웃/OCR/교정을 건너뛸 수 있습니다
- 표점 없이 바로 번역을 할 수도 있습니다 (표점이 있으면 문장 단위 분리가 더 정확합니다)
- 주석은 번역 전이나 후 언제든 가능합니다

### Q. 다른 연구자와 공유하려면?

두 가지 방법이 있습니다:
1. **JSON 스냅샷**: 해석 저장소를 JSON으로 내보내기 → 상대방이 가져오기
2. **Git 원격 저장소**: GitHub 등에 Push → 상대방이 Clone/Pull

---

## 문서 안내

더 자세한 내용은 다음 문서를 참고하세요:

| 문서 | 대상 | 내용 |
|------|------|------|
| 이 문서 (`user-guide.md`) | 연구자 | 사용 방법 |
| [README.md](../README.md) | 설치자 | 설치·실행 |
| [platform-v7.md](platform-v7.md) | 개발자/설계자 | 전체 아키텍처 |
| [DECISIONS.md](DECISIONS.md) | 개발자 | 설계 결정 근거 |
| [schemas/README.md](../schemas/README.md) | 개발자 | JSON 스키마 구조 |
| [architecture-diagrams.md](architecture-diagrams.md) | 전체 | Mermaid 다이어그램 |
